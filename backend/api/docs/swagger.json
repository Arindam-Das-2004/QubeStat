{
  "openapi": "3.0.0",
  "info": {
    "title": "QubeStat API",
    "description": "API documentation for the QubeStat application. All endpoints support both JSON and XML response formats. To receive XML responses, append `?xml=true` to any API URL.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost/qubestat/backend/api/",
      "description": "Local development server"
    }
  ],
  "paths": {
    "/db/status": {
      "get": {
        "summary": "Get database status",
        "description": "Returns database connection status and table counts",
        "tags": ["Database"],
        "parameters": [
          {
            "name": "xml",
            "in": "query",
            "description": "Set to 'true' to receive response in XML format",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["true"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DbStatus"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/DbStatus"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/db/users": {
      "get": {
        "summary": "Get all users",
        "description": "Returns a list of all users (passwords excluded)",
        "tags": ["Database"],
        "parameters": [
          {
            "name": "xml",
            "in": "query",
            "description": "Set to 'true' to receive response in XML format",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["true"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserList"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/UserList"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/db/products": {
      "get": {
        "summary": "Get all products",
        "description": "Returns a list of all products",
        "tags": ["Database"],
        "parameters": [
          {
            "name": "xml",
            "in": "query",
            "description": "Set to 'true' to receive response in XML format",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["true"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProductList"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/ProductList"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/db/orders": {
      "get": {
        "summary": "Get all orders",
        "description": "Returns a list of all orders with related user and product data",
        "tags": ["Database"],
        "parameters": [
          {
            "name": "xml",
            "in": "query",
            "description": "Set to 'true' to receive response in XML format",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["true"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderList"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/OrderList"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/db/settings": {
      "get": {
        "summary": "Get system settings",
        "description": "Returns all system settings",
        "tags": ["Database"],
        "parameters": [
          {
            "name": "xml",
            "in": "query",
            "description": "Set to 'true' to receive response in XML format",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["true"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SettingsList"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/SettingsList"
                }
              }
            }
          },
          "500": {
            "description": "Database error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "DbStatus": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "success"
          },
          "connection": {
            "type": "string",
            "example": "active"
          },
          "mysql_version": {
            "type": "string",
            "example": "8.0.27"
          },
          "table_counts": {
            "type": "object",
            "properties": {
              "users": {
                "type": "integer",
                "example": 10
              },
              "products": {
                "type": "integer",
                "example": 15
              },
              "orders": {
                "type": "integer",
                "example": 15
              },
              "settings": {
                "type": "integer",
                "example": 10
              }
            }
          },
          "timestamp": {
            "type": "string",
            "example": "2023-04-22 10:15:30"
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "username": {
            "type": "string",
            "example": "jsmith"
          },
          "email": {
            "type": "string",
            "example": "john.smith@example.com"
          },
          "first_name": {
            "type": "string",
            "example": "John"
          },
          "last_name": {
            "type": "string",
            "example": "Smith"
          },
          "role": {
            "type": "string",
            "enum": ["admin", "user", "manager"],
            "example": "user"
          },
          "status": {
            "type": "string",
            "enum": ["active", "inactive", "suspended"],
            "example": "active"
          },
          "created_at": {
            "type": "string",
            "example": "2023-04-01 09:30:00"
          }
        }
      },
      "UserList": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "success"
          },
          "count": {
            "type": "integer",
            "example": 10
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/User"
            }
          }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "name": {
            "type": "string",
            "example": "Smartphone X"
          },
          "description": {
            "type": "string",
            "example": "Latest model with advanced features"
          },
          "price": {
            "type": "number",
            "format": "decimal",
            "example": 999.99
          },
          "stock": {
            "type": "integer",
            "example": 50
          },
          "category": {
            "type": "string",
            "example": "Electronics"
          },
          "image_url": {
            "type": "string",
            "example": "img/products/smartphone-x.jpg"
          },
          "status": {
            "type": "string",
            "enum": ["available", "out_of_stock", "discontinued"],
            "example": "available"
          },
          "created_at": {
            "type": "string",
            "example": "2023-04-01 09:30:00"
          },
          "updated_at": {
            "type": "string",
            "example": "2023-04-01 09:30:00"
          }
        }
      },
      "ProductList": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "success"
          },
          "count": {
            "type": "integer",
            "example": 15
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Product"
            }
          }
        }
      },
      "Order": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "user_id": {
            "type": "integer",
            "example": 2
          },
          "product_id": {
            "type": "integer",
            "example": 1
          },
          "quantity": {
            "type": "integer",
            "example": 1
          },
          "total_price": {
            "type": "number",
            "format": "decimal",
            "example": 999.99
          },
          "status": {
            "type": "string",
            "enum": ["pending", "processing", "shipped", "delivered", "canceled"],
            "example": "delivered"
          },
          "payment_method": {
            "type": "string",
            "example": "Credit Card"
          },
          "shipping_address": {
            "type": "string",
            "example": "123 Main St, Anytown, AN 12345"
          },
          "created_at": {
            "type": "string",
            "example": "2023-04-01 09:30:00"
          },
          "updated_at": {
            "type": "string",
            "example": "2023-04-01 09:30:00"
          },
          "username": {
            "type": "string",
            "example": "jsmith"
          },
          "email": {
            "type": "string",
            "example": "john.smith@example.com"
          },
          "product_name": {
            "type": "string",
            "example": "Smartphone X"
          },
          "product_price": {
            "type": "number",
            "format": "decimal",
            "example": 999.99
          }
        }
      },
      "OrderList": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "success"
          },
          "count": {
            "type": "integer",
            "example": 15
          },
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Order"
            }
          }
        }
      },
      "Setting": {
        "type": "object",
        "properties": {
          "value": {
            "type": "string",
            "example": "QubeStat"
          },
          "description": {
            "type": "string",
            "example": "The name of the site"
          }
        }
      },
      "SettingsList": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "success"
          },
          "count": {
            "type": "integer",
            "example": 10
          },
          "data": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/Setting"
            },
            "example": {
              "site_name": {
                "value": "QubeStat",
                "description": "The name of the site"
              },
              "theme_color": {
                "value": "#6a1b9a",
                "description": "Primary theme color"
              }
            }
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "error"
          },
          "message": {
            "type": "string",
            "example": "Database connection failed: SQLSTATE[HY000] [1045] Access denied"
          }
        }
      }
    }
  }
} 